<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Parallax Demo â€” Works on iOS, macOS, Chrome</title>
  <style>
    :root{
      --bg1:url('https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=1600&q=80');
      --bg2:url('https://images.unsplash.com/photo-1491553895911-0055eca6402d?auto=format&fit=crop&w=1600&q=80');
      --bg3:url('https://images.unsplash.com/photo-1470770903676-69b98201ea1c?auto=format&fit=crop&w=1600&q=80');
      --accent:#ff6b6b;
      --text:#0f172a;
      --overlay:rgba(0,0,0,0.25);
      --max-width:1100px;
    }

    /* Basic page reset */
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{color:var(--text);background:#fff;line-height:1.5;-webkit-font-smoothing:antialiased}

    /* Container and layout */
    .site{min-height:100vh;overflow-x:hidden}
    header{position:fixed;left:0;right:0;top:0;height:64px;display:flex;align-items:center;justify-content:center;z-index:30;padding:0 16px;background:linear-gradient(180deg,rgba(255,255,255,0.85),rgba(255,255,255,0.6));backdrop-filter:blur(6px)}
    header .brand{font-weight:700;color:var(--text)}

    /* Parallax stage, using stacked layers */
    .parallax{position:relative;height:100vh;overflow:hidden}
    .layer{position:absolute;left:0;right:0;top:0;bottom:0;background-repeat:no-repeat;background-position:center center;background-size:cover;will-change:transform;transform:translate3d(0,0,0)}

    .layer--back{z-index:0;background-image:var(--bg1);filter:contrast(1.02)}
    .layer--mid{z-index:1;background-image:var(--bg2);mix-blend-mode:normal;opacity:0.95}
    .layer--front{z-index:2;background-image:var(--bg3);opacity:0.9}

    /* Overlay content on top of parallax */
    .hero-contents{position:relative;z-index:10;height:100%;display:flex;align-items:center;justify-content:center}
    .card{max-width:var(--max-width);margin:0 auto;padding:28px;border-radius:14px;background:linear-gradient(180deg,rgba(255,255,255,0.9),rgba(255,255,255,0.8));box-shadow:0 10px 30px rgba(10,20,40,0.12);text-align:center}
    .card h1{margin:0 0 8px;font-size:clamp(28px,4vw,44px)}
    .card p{margin:0 0 16px;color:#334155}
    .btn{display:inline-block;padding:10px 18px;border-radius:10px;background:var(--accent);color:white;text-decoration:none;font-weight:600}

    /* Following content sections */
    .section{padding:80px 16px;background:#fff}
    .section--alt{background:#f8fafc}
    .container{max-width:var(--max-width);margin:0 auto}

    /* small UI niceties */
    .features{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:18px;margin-top:28px}
    .feature{padding:18px;border-radius:10px;background:white;box-shadow:0 6px 18px rgba(10,20,40,0.06)}

    footer{padding:36px 16px;text-align:center;color:#94a3b8}

    /* Accessibility pref: prefers-reduced-motion */
    @media (prefers-reduced-motion:reduce){
      .layer{transition:none!important}
      .card{transition:none!important}
    }

    /* iOS momentum scrolling for containers, helps touch feel */
    .site, .section{ -webkit-overflow-scrolling:touch }

    /* Make sure the demo is usable on very small screens */
    @media (max-width:520px){
      header{height:56px}
      .card{padding:18px;border-radius:12px}
    }
  </style>
</head>
<body>
  <div class="site">
    <header>
      <div class="brand">Parallax Demo</div>
    </header>

    <main>
      <section class="parallax" id="parallax">
        <div class="layer layer--back" data-speed="0.12" aria-hidden="true"></div>
        <div class="layer layer--mid" data-speed="0.28" aria-hidden="true"></div>
        <div class="layer layer--front" data-speed="0.55" aria-hidden="true"></div>

        <div class="hero-contents">
          <div class="card">
            <h1>Parallax that works on iOS, macOS, and Chrome</h1>
            <p>Lightweight, touch-friendly parallax using transform based animation and requestAnimationFrame, for smooth performance across browsers.</p>
            <a class="btn" href="#features">See features</a>
          </div>
        </div>
      </section>

      <section class="section" id="features">
        <div class="container">
          <h2>Features</h2>
          <div class="features">
            <div class="feature">
              <strong>Transform based</strong>
              <div>All movement uses CSS transform and translate3d for GPU compositing.</div>
            </div>
            <div class="feature">
              <strong>Touch friendly</strong>
              <div>Works on iOS Safari and Chrome for Android, no background-attachment hacks.</div>
            </div>
            <div class="feature">
              <strong>Reduced motion support</strong>
              <div>Respects user preference for reduced motion, disabling parallax safely.</div>
            </div>
            <div class="feature">
              <strong>Single file</strong>
              <div>Drop into any static host, or save as a file and open locally.</div>
            </div>
          </div>

          <h3 style="margin-top:28px">How it works</h3>
          <p>Each layer carries a data-speed attribute. As the page scrolls, we calculate a translateY value per layer and set the transform using requestAnimationFrame. That approach avoids layout thrashing, keeps animation on the compositor, and avoids using background-attachment fixed, which is not supported consistently on iOS.</p>
        </div>
      </section>

      <section class="section section--alt">
        <div class="container">
          <h2>Try it</h2>
          <ol>
            <li>Save the file as <code>parallax-demo.html</code> and open it in Chrome on macOS to see the effect.</li>
            <li>Open the same file in Safari on iOS to confirm touch and momentum work well. If you have "Reduce Motion" enabled in system settings, the parallax will be disabled automatically.</li>
            <li>To change background images, edit the <code>--bg1</code>, <code>--bg2</code>, <code>--bg3</code> variables at the top of the file.</li>
          </ol>
        </div>
      </section>

      <footer>
        Built for demo purposes, compatible with modern Safari and Chrome.
      </footer>
    </main>
  </div>

  <script>
    (function(){
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if(prefersReduced) return; // do nothing if user prefers reduced motion

      const layers = Array.from(document.querySelectorAll('.parallax .layer'));
      const parallax = document.getElementById('parallax');
      let latestKnownScrollY = 0;
      let ticking = false;

      function onScroll(){
        latestKnownScrollY = window.scrollY || window.pageYOffset;
        requestTick();
      }

      function requestTick(){
        if(!ticking){
          requestAnimationFrame(update);
        }
        ticking = true;
      }

      function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

      function update(){
        const viewportHeight = window.innerHeight;
        const progress = clamp(latestKnownScrollY / viewportHeight, 0, 1.6);

        layers.forEach(layer => {
          const speed = parseFloat(layer.getAttribute('data-speed')) || 0.2;
          // calculate offset relative to viewport center, use translate3d to keep on compositor
          const offset = latestKnownScrollY * speed;
          layer.style.transform = `translate3d(0, ${-offset}px, 0)`;
        });

        ticking = false;
      }

      // improve responsiveness when resizing
      window.addEventListener('scroll', onScroll, {passive:true});
      window.addEventListener('resize', () => { requestTick(); }, {passive:true});

      // initial frame
      update();

      // small enhancement: parallax reacts slightly to device orientation on supported devices
      if(window.DeviceOrientationEvent && typeof DeviceOrientationEvent.requestPermission === 'function'){
        // iOS 13+ requires permission, ask only if user touches the page
        window.addEventListener('pointerdown', function ask(){
          DeviceOrientationEvent.requestPermission().catch(()=>{}).then(()=>{
            window.removeEventListener('pointerdown', ask);
            window.addEventListener('deviceorientation', (e) => {
              // subtle tilt, used as additive transform
              const tilt = clamp(e.gamma || 0, -30, 30) / 30; // -1..1
              layers.forEach((layer,i)=>{
                const depth = (i+1) * 6; // small pixel shift
                const x = tilt * depth;
                // combine existing translate with tilt, keep using translate3d
                const current = layer.style.transform || 'translate3d(0,0,0)';
                layer.style.transform = current.replace(/translate3d\(([^,]+),\s*([^,]+),\s*([^\)]+)\)/, `translate3d(${x}px, $2, $3)`);
              });
            }, {passive:true});
          });
        }, {once:true});
      } else if(window.DeviceOrientationEvent){
        window.addEventListener('deviceorientation', (e) => {
          const tilt = clamp(e.gamma || 0, -30, 30) / 30;
          layers.forEach((layer,i)=>{
            const depth = (i+1) * 6;
            const x = tilt * depth;
            const current = layer.style.transform || 'translate3d(0,0,0)';
            layer.style.transform = current.replace(/translate3d\(([^,]+),\s*([^,]+),\s*([^\)]+)\)/, `translate3d(${x}px, $2, $3)`);
          });
        }, {passive:true});
      }

    })();
  </script>
</body>
</html>
